# ๐ MCP Server ะดะปั Financial Methodologies KB

**Model Context Protocol (MCP) ัะตัะฒะตั** ะดะปั ะฟัะตะดะพััะฐะฒะปะตะฝะธั AI ะฐะณะตะฝัะฐะผ ะดะพัััะฟะฐ ะบ ะฑะฐะทะต ะทะฝะฐะฝะธะน ัะธะฝะฐะฝัะพะฒัั ะผะตัะพะดะพะปะพะณะธะน ัะตัะตะท ััะฐะฝะดะฐััะธะทะธัะพะฒะฐะฝะฝัะน API.

---

## ๐ฏ ะงัะพ ััะพ ัะฐะบะพะต?

MCP ัะตัะฒะตั โ ััะพ "ะผะพัั" ะผะตะถะดั AI ะธะฝััััะผะตะฝัะฐะผะธ (Claude Desktop, VS Code Copilot, Cline, Cursor) ะธ ะฝะฐัะธะผะธ ะฑะฐะทะฐะผะธ ะดะฐะฝะฝัั:

- **Qdrant** (ะฒะตะบัะพัะฝะฐั ะะ): ัะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ ะฟะพ 137+ chunks ะธะท ะบะฝะธะณ
- **ArangoDB** (ะณัะฐั ะทะฝะฐะฝะธะน): ะผะตัะพะดะพะปะพะณะธะธ, stages, indicators, glossary (33 stages, 17 indicators, 27 terms)
- **File System**: ะฟััะผะพะน ะดะพัััะฟ ะบ markdown ัะฐะนะปะฐะผ ะผะตัะพะดะพะปะพะณะธะน

---

## โก ะัััััะน ััะฐัั (3 ะผะธะฝััั)

### 1. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
cd /home/leval907/financial-methodologies-kb/financial-methodologies-kb
source .venv/bin/activate

# ะฃััะฐะฝะพะฒะธัั MCP ะฟะฐะบะตัั
pip install -r mcp/requirements.txt
```

### 2. ะัะพะฒะตัะบะฐ ะฑะฐะท ะดะฐะฝะฝัั

```bash
# Qdrant ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟััะตะฝ
curl http://localhost:6333/health

# ArangoDB ะดะพะปะถะตะฝ ะฑััั ะดะพัััะฟะตะฝ
curl http://localhost:8529/_api/version
```

### 3. ะขะตัั ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ

```bash
# ะะฐะฟัััะธัั MCP ัะตัะฒะตั (Ctrl+C ะดะปั ะพััะฐะฝะพะฒะบะธ)
python -m mcp.server

# ะัะปะธ ะฒัั ะพะบ, ัะฒะธะดะธัั:
# MCP server started on stdio...
```

### 4. ะะพะดะบะปััะตะฝะธะต ะบ ะบะปะธะตะฝัั

```bash
# ะะฒัะพะผะฐัะธัะตัะบะฐั ะฝะฐัััะพะนะบะฐ (ัะตะบะพะผะตะฝะดัะตััั)
chmod +x mcp/setup_clients.sh
./mcp/setup_clients.sh

# ะัะฑะตัะธ ัะฒะพะน AI ะบะปะธะตะฝั (Claude Desktop, VS Code, etc.)
```

**ะะพัะพะฒะพ!** ะะตัะตะทะฐะฟัััะธ AI ะบะปะธะตะฝั ะธ ะฟะพะฟัะพะฑัะน:
```
ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ ะฑัะดะถะตัะธัะพะฒะฐะฝะธะต
```

---

## ๐๏ธ ะะพัััะฟะฝัะต ะธะฝััััะผะตะฝัั

### 1๏ธโฃ `semantic_search` โ Qdrant

**ะะฟะธัะฐะฝะธะต:**  
ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ ะฟะพ ะฒะตะบัะพัะฝะพะน ะฑะฐะทะต ะดะฐะฝะฝัั. ะะฐัะพะดะธั ัะตะปะตะฒะฐะฝัะฝัะต ััะฐะณะผะตะฝัั ัะตะบััะฐ ะธะท ะบะฝะธะณ.

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**

```
User: ะะฐะบ ะฟะพัััะพะธัั ะฑัะดะถะตั ะดะฒะธะถะตะฝะธั ะดะตะฝะตะถะฝัั ััะตะดััะฒ?

AI โ ะฒัะทัะฒะฐะตั semantic_search(query="ะฑัะดะถะตั ะดะฒะธะถะตะฝะธั ะดะตะฝะตะถะฝัั ััะตะดััะฒ", top_k=5)
   โ ะฟะพะปััะฐะตั 5 chunks ะธะท Qdrant ั score > 0.85
   โ ะพัะฒะตัะฐะตั ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะนะดะตะฝะฝะพะณะพ ะบะพะฝัะตะบััะฐ
```

**ะะฐัะฐะผะตััั:**
- `query` (ะพะฑัะทะฐัะตะปัะฝัะน): ัะตะบัั ะทะฐะฟัะพัะฐ
- `top_k` (default: 5): ะบะพะปะธัะตััะฒะพ ัะตะทัะปััะฐัะพะฒ (1-50)
- `methodology_id` (optional): ัะธะปััั ะฟะพ ะผะตัะพะดะพะปะพะณะธะธ

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "query": "ะฑัะดะถะตั ะดะฒะธะถะตะฝะธั ะดะตะฝะตะถะฝัั ััะตะดััะฒ",
  "collection": "books_budgeting_step_by_step",
  "total_results": 5,
  "results": [
    {
      "chunk_id": 42,
      "text": "ะัะดะถะตั ะดะฒะธะถะตะฝะธั ะดะตะฝะตะถะฝัั ััะตะดััะฒ (ะะะะก) ัััะพะธััั...",
      "page": 156,
      "score": 0.89,
      "metadata": {
        "book_id": "budgeting-step-by-step",
        "chunk_index": 42
      }
    }
  ]
}
```

---

### 2๏ธโฃ `get_methodology_context` โ ArangoDB

**ะะฟะธัะฐะฝะธะต:**  
ะะพะปััะธัั ััััะบัััะธัะพะฒะฐะฝะฝัั ะธะฝัะพัะผะฐัะธั ะพ ะผะตัะพะดะพะปะพะณะธะธ ะธะท ะณัะฐัะฐ ะทะฝะฐะฝะธะน.

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**

```
User: ะะพะบะฐะถะธ ะฒัะต ััะฐะฟั ะผะตัะพะดะพะปะพะณะธะธ budgeting-step-by-step

AI โ ะฒัะทัะฒะฐะตั get_methodology_context(methodology_id="budgeting-step-by-step")
   โ ะฟะพะปััะฐะตั 7 stages + 17 indicators ะธะท ArangoDB
   โ ะฒัะฒะพะดะธั ััััะบัััะธัะพะฒะฐะฝะฝัะน ัะฟะธัะพะบ
```

**ะะฐัะฐะผะตััั:**
- `methodology_id` (ะพะฑัะทะฐัะตะปัะฝัะน): "toc", "budgeting-step-by-step", "accounting-basics-test"
- `include_stages` (default: true)
- `include_indicators` (default: true)
- `include_tools` (default: false)
- `include_rules` (default: false)

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "methodology": {
    "name": "ะัะดะถะตัะธัะพะฒะฐะฝะธะต: ัะฐะณ ะทะฐ ัะฐะณะพะผ",
    "author": "ะะพะฑัะพะฒะพะปััะบะธะน ะ., ะะฐัะฐะฑะฐะฝะพะฒ ะ."
  },
  "stages": [
    {"id": "budg_s_1", "name": "ะะพััะฐะฝะพะฒะบะฐ ัะตะปะตะน", "order": 1},
    {"id": "budg_s_2", "name": "ะะปะฐะฝะธัะพะฒะฐะฝะธะต", "order": 2}
  ],
  "indicators": [
    {"name": "ะขะพัะบะฐ ะฑะตะทัะฑััะพัะฝะพััะธ", "formula": "..."}
  ],
  "stats": {
    "total_stages": 7,
    "total_indicators": 17
  }
}
```

---

### 3๏ธโฃ `get_glossary_term` โ ArangoDB

**ะะฟะธัะฐะฝะธะต:**  
ะะพะปััะธัั ะพะฟัะตะดะตะปะตะฝะธะต ัะตัะผะธะฝะฐ ะธะท ะณะปะพััะฐัะธั.

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**

```
User: ะงัะพ ัะฐะบะพะต contribution margin?

AI โ ะฒัะทัะฒะฐะตั get_glossary_term(term="contribution margin")
   โ ะฟะพะปััะฐะตั ะพะฟัะตะดะตะปะตะฝะธะต ะธะท glossary_terms
   โ ะพะฑัััะฝัะตั ัะตัะผะธะฝ + ะฟะพะบะฐะทัะฒะฐะตั ัะฒัะทะฐะฝะฝัะต ะฟะพะฝััะธั
```

**ะะฐัะฐะผะตััั:**
- `term` (ะพะฑัะทะฐัะตะปัะฝัะน): ัะตัะผะธะฝ ะดะปั ะฟะพะธัะบะฐ
- `language` (default: "ru"): "ru" ะธะปะธ "en"
- `include_related` (default: true): ะฟะพะบะฐะทะฐัั ัะฒัะทะฐะฝะฝัะต ัะตัะผะธะฝั

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "term": "ะะฐัะถะธะฝะฐะปัะฝัะน ะดะพัะพะด",
  "aliases": ["contribution margin", "ะฒะบะปะฐะด ะฝะฐ ะฟะพะบัััะธะต"],
  "definition": "ะะฐะทะฝะธัะฐ ะผะตะถะดั ะฒััััะบะพะน ะธ ะฟะตัะตะผะตะฝะฝัะผะธ ะทะฐััะฐัะฐะผะธ",
  "formula": "ะะ = ะััััะบะฐ - ะะตัะตะผะตะฝะฝัะต ะทะฐััะฐัั",
  "related_terms": [
    {"term": "ะขะพัะบะฐ ะฑะตะทัะฑััะพัะฝะพััะธ", "definition": "..."}
  ]
}
```

---

### 4๏ธโฃ `read_methodology_file` โ File System

**ะะฟะธัะฐะฝะธะต:**  
ะัะพัะธัะฐัั markdown ัะฐะนะปั ะผะตัะพะดะพะปะพะณะธะธ ะธะท ัะฐะนะปะพะฒะพะน ัะธััะตะผั.

**ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**

```
User: ะะพะบะฐะถะธ ะฟะพะปะฝะพะต ะพะฟะธัะฐะฝะธะต ััะฐะฟะฐ "ะะพััะฐะฝะพะฒะบะฐ ัะตะปะตะน"

AI โ ะฒัะทัะฒะฐะตั read_methodology_file(
       methodology_id="budgeting-step-by-step",
       file_type="stages",
       specific_file="stage_1.md"
     )
   โ ะฟะพะปััะฐะตั ะฟะพะปะฝัะน markdown ัะตะบัั ััะฐะฟะฐ
   โ ะฒัะฒะพะดะธั ะดะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต
```

**ะะฐัะฐะผะตััั:**
- `methodology_id` (ะพะฑัะทะฐัะตะปัะฝัะน)
- `file_type`: "methodology", "outline", "stages", "indicators", "tools", "rules"
- `specific_file` (optional): ะบะพะฝะบัะตัะฝัะน ัะฐะนะป (ะฝะฐะฟัะธะผะตั, "stage_1.md")

---

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   AI Clients (Claude, VS Code, Cline, etc)  โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ MCP Protocol (stdio)
                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         MCP Server (Python)                  โ
โ  mcp/server.py                               โ
โ                                              โ
โ  Tools:                                     โ
โ  โโ semantic_search      (Qdrant)          โ
โ  โโ get_methodology      (ArangoDB)        โ
โ  โโ get_glossary_term    (ArangoDB)        โ
โ  โโ read_methodology_md  (File System)     โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
    โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
    โผ               โผ               โผ
โโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโ
โ Qdrant  โ   โ ArangoDB โ   โ   FS     โ
โ :6333   โ   โ :8529    โ   โ data/    โ
โโโโโโโโโโโ   โโโโโโโโโโโโ   โโโโโโโโโโโโ
```

---

## ๐ ะกัััะบัััะฐ MCP

```
mcp/
โโโ __init__.py
โโโ server.py              # ะะปะฐะฒะฝัะน MCP ัะตัะฒะตั (stdio)
โโโ requirements.txt       # MCP ะทะฐะฒะธัะธะผะพััะธ
โ
โโโ tools/                 # MCP ะธะฝััััะผะตะฝัั
โ   โโโ __init__.py
โ   โโโ search.py          # Qdrant semantic search
โ   โโโ graph.py           # ArangoDB graph queries
โ   โโโ glossary.py        # Glossary resolver
โ   โโโ files.py           # File system access
โ
โโโ clients/               # ะะพะฝัะธะณะธ ะดะปั ะบะปะธะตะฝัะพะฒ
โ   โโโ claude.json        # Claude Desktop
โ   โโโ vscode.json        # VS Code MCP extension
โ   โโโ cline.json         # Cline config
โ   โโโ README.md          # ะะฝััััะบัะธั ะฟะพ ะฟะพะดะบะปััะตะฝะธั
โ
โโโ setup_clients.sh       # ะกะบัะธะฟั ะฝะฐัััะพะนะบะธ ะบะปะธะตะฝัะพะฒ
โโโ README.md              # ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
```

---

## ๐ ะะพะดะบะปััะตะฝะธะต ะบะปะธะตะฝัะพะฒ

### Claude Desktop

```bash
./mcp/setup_clients.sh
# ะัะฑะตัะธ: 1 (macOS) ะธะปะธ 2 (Linux)
# ะะตัะตะทะฐะฟัััะธ Claude Desktop
```

**ะะปะธ ะฒัััะฝัั:**

1. ะัะบัะพะน `~/Library/Application Support/Claude/claude_desktop_config.json`
2. ะกะบะพะฟะธััะน ัะพะดะตัะถะธะผะพะต ะธะท `mcp/clients/claude.json`
3. ะะตัะตะทะฐะฟัััะธ Claude

### VS Code

```bash
./mcp/setup_clients.sh
# ะัะฑะตัะธ: 3 (VS Code)
# ะกะบะพะฟะธััะน ะฒัะฒะพะด ะฒ VS Code settings.json
```

### ะััะฐะปัะฝัะต ะบะปะธะตะฝัั

ะกะผ. [clients/README.md](clients/README.md)

---

## โ ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

### ะขะตัั 1: Semantic Search

```
User: ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ ัะพัะบั ะฑะตะทัะฑััะพัะฝะพััะธ

Expected: Claude ะฒัะทัะฒะฐะตั semantic_search โ ะฟะพะปััะฐะตั chunks โ ะพัะฒะตัะฐะตั ั ัะพัะผัะปะฐะผะธ
```

### ะขะตัั 2: Methodology Context

```
User: ะะพะบะฐะถะธ ะฒัะต ััะฐะฟั ะฑัะดะถะตัะธัะพะฒะฐะฝะธั

Expected: Claude ะฒัะทัะฒะฐะตั get_methodology_context โ ะฟะพะปััะฐะตั 7 stages โ ะฒัะฒะพะดะธั ัะฟะธัะพะบ
```

### ะขะตัั 3: Glossary

```
User: ะงัะพ ัะฐะบะพะต ะพะฟะตัะฐัะธะพะฝะฝัะน ัััะฐะณ?

Expected: Claude ะฒัะทัะฒะฐะตั get_glossary_term โ ะฟะพะปััะฐะตั ะพะฟัะตะดะตะปะตะฝะธะต + ัะพัะผัะปั
```

---

## ๐ Troubleshooting

### ะัะพะฑะปะตะผะฐ: "MCP server not found"

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัั ะฟััั ะบ Python
which python

# ะะฑะฝะพะฒะธ ะฒ ะบะพะฝัะธะณะต (claude.json, vscode.json, etc.)
"command": "/ะฐะฑัะพะปััะฝัะน/ะฟััั/ะบ/.venv/bin/python"
```

---

### ะัะพะฑะปะตะผะฐ: "Qdrant connection refused"

**ะะตัะตะฝะธะต:**
```bash
# ะะฐะฟัััะธ Qdrant
docker-compose -f docker-compose.rag.yml up -d

# ะัะพะฒะตัั ััะฐััั
curl http://localhost:6333/health
```

---

### ะัะพะฑะปะตะผะฐ: "ArangoDB authentication failed"

**ะะตัะตะฝะธะต:**
```bash
# ะัะพะฒะตัั .env.arango
cat .env.arango

# ะะพะปะถะฝะพ ะฑััั:
ARANGO_HOST=http://localhost:8529
ARANGO_DB=fin_kb_method
ARANGO_USER=root
ARANGO_PASSWORD=strongpassword
```

---

## ๐ ะะตััะธะบะธ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ะัะพัะผะพัั ะปะพะณะพะฒ MCP

```bash
# ะะฐะฟัััะธ ัะตัะฒะตั ั ะปะพะณะฐะผะธ
python -m mcp.server 2>&1 | tee mcp_server.log

# ะะพะณะธ ะบะปะธะตะฝัะฐ (Claude Desktop)
tail -f ~/Library/Logs/Claude/mcp.log
```

### ะกัะฐัะธััะธะบะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

```bash
# TODO: ะดะพะฑะฐะฒะธัั metrics dashboard
# ะะปะฐะฝะธััะตััั: ะบะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ, ะฒัะตะผั ะพัะฒะตัะฐ, ะฟะพะฟัะปััะฝัะต ะทะฐะฟัะพัั
```

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [MCP Specification](https://modelcontextprotocol.io/)
- [MCP Python SDK](https://github.com/anthropics/anthropic-mcp)
- [Claude Desktop MCP Integration](https://docs.anthropic.com/claude/docs/mcp)
- [GitHub Issue #27](.github/ISSUE_MCP_SERVER.md) โ Roadmap ัะฐะทัะฐะฑะพัะบะธ

---

## ๐ Roadmap

### v0.1 (MVP) โ
- [x] ะะฐะทะพะฒะฐั ะธะฝััะฐััััะบัััะฐ
- [x] semantic_search tool (Qdrant)
- [x] get_methodology_context tool (ArangoDB)
- [x] get_glossary_term tool (ArangoDB)
- [x] read_methodology_file tool (FS)
- [x] Claude Desktop config
- [x] VS Code config

### v0.2 โ In Progress
- [ ] ะะตัะธัะพะฒะฐะฝะธะต ะทะฐะฟัะพัะพะฒ
- [ ] ะะพะณะธัะพะฒะฐะฝะธะต ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- [ ] ะะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ
- [ ] ะคะธะปัััะฐัะธั ะฟะพ book_id ะฒะพ ะฒัะตั tools

### v1.0 โ Production Ready
- [ ] ะัะต ะบะปะธะตะฝัั ะฝะฐัััะพะตะฝั (Claude, VS Code, Cline, Cursor)
- [ ] Full test coverage (>80%)
- [ ] Monitoring dashboard
- [ ] ะะพะบัะผะตะฝัะฐัะธั API

---

## ๐ ะะธัะตะฝะทะธั

MIT License

---

**ะะตััะธั:** 0.1.0  
**ะะฐัะฐ:** 15 ะดะตะบะฐะฑัั 2025  
**ะกัะฐััั:** Ready for testing ๐งช
